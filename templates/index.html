<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestor de Tareas</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
<script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("{{ url_for('static', filename='service-worker.js') }}");
  }
</script>

</head>
<body class="bg-light">

  <div class="container py-4">
    <h1 class="text-center mb-4">📋 Gestor de Tareas por Grupos</h1>

    <!-- Crear nuevo grupo -->
    <div class="card shadow-sm mb-4">
      <div class="card-body">
        <h5 class="card-title">➕ Crear Grupo</h5>
        <form action="/grupo/nuevo" method="POST" class="row g-2">
          <div class="col-md-10">
            <input type="text" name="nombre" class="form-control" placeholder="Nombre del grupo" required>
          </div>
          <div class="col-md-2">
            <button type="submit" class="btn btn-success w-100">Crear</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Listado de grupos -->
    {% for grupo in grupos %}
    <div class="card shadow-sm mb-4">
      <div class="card-body">
        <h3 class="card-title">👥 {{ grupo.nombre }}</h3>

        <!-- Agregar miembro -->
        <form action="/miembro/nuevo/{{ grupo.id }}" method="POST" class="row g-2 mb-3">
          <div class="col-md-4">
            <input type="text" name="nombre" class="form-control" placeholder="Nombre del miembro" required>
          </div>
          <div class="col-md-4">
            <input type="text" name="telegram_id" class="form-control" placeholder="Telegram ID (número)" required>
          </div>
          <div class="col-md-4">
            <button type="submit" class="btn btn-primary w-100">Agregar miembro</button>
          </div>
        </form>

        <!-- Lista de miembros -->
        <h6>Miembros:</h6>
        <ul class="list-group mb-3">
          {% for m in grupo.miembros %}
          <li class="list-group-item d-flex justify-content-between align-items-center">
            {{ m.nombre }} 
            <span class="badge bg-info">ID: {{ m.telegram_id }}</span>
          </li>
          {% else %}
          <li class="list-group-item">No hay miembros registrados.</li>
          {% endfor %}
        </ul>

        <!-- Agregar tarea -->
        <form action="/tarea/nueva/{{ grupo.id }}" method="POST" class="row g-2 mb-3">
          <div class="col-md-3">
            <input type="text" name="curso" class="form-control" placeholder="Curso" required>
          </div>
          <div class="col-md-4">
            <input type="text" name="descripcion" class="form-control" placeholder="Descripción" required>
          </div>
          <div class="col-md-3">
            <input type="date" name="fecha" class="form-control" required>
          </div>
          <div class="col-md-2">
            <button type="submit" class="btn btn-success w-100">Agregar tarea</button>
          </div>
        </form>

        <!-- Lista de tareas -->
        <h6>Tareas:</h6>
        <ul class="list-group">
          {% for t in grupo.tareas %}
          <li class="list-group-item d-flex justify-content-between align-items-center {% if t.hecha %}list-group-item-success{% endif %}">
            <div>
              <b>{{ t.curso }}</b>: {{ t.descripcion }}
              <br><small>📅 {{ t.fecha }}</small>
            </div>
            <div>
              {% if not t.hecha %}
              <a href="/tarea/hecha/{{ t.id }}" class="btn btn-sm btn-primary">✔️ Hecha</a>
              {% endif %}
              <a href="/tarea/eliminar/{{ t.id }}" class="btn btn-sm btn-danger">🗑️</a>
            </div>
          </li>
          {% else %}
          <li class="list-group-item">No hay tareas en este grupo.</li>
          {% endfor %}
        </ul>

      </div>
    </div>
    {% else %}
    <p class="text-center">No hay grupos aún. ¡Crea uno arriba! 🎉</p>
    {% endfor %}
  </div>

</body>
</html>
